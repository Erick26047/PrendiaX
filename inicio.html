<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Inicio | PrendiaX</title>
   <link rel="icon" type="image/png" href="PRENDIAX.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css?v=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js"></script>
 <style>
body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f4f4f4;
  color: #000;
  position: relative;
  overflow-x: hidden;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* --- ESTILOS RESPUESTAS Y MENCIONES (NUEVO) --- */
.comment.reply {
    margin-left: 40px; /* Sangría para respuestas */
    border-left: 2px solid #e0e0e0;
    padding-left: 10px;
    background-color: rgba(0,0,0,0.02);
    border-radius: 0 10px 10px 0;
}

.comment-actions {
    display: flex;
    gap: 15px;
    margin-top: 5px;
    font-size: 12px;
}

.reply-btn {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-weight: 600;
    padding: 0;
    font-size: 12px;
    transition: color 0.2s;
}

.reply-btn:hover {
    color: #1976d2;
    text-decoration: underline;
}

.reply-indicator {
    display: none; /* Oculto por defecto */
    background-color: #e3f2fd;
    color: #1976d2;
    padding: 5px 10px;
    font-size: 12px;
    border-radius: 10px 10px 0 0;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #bbdefb;
    margin-bottom: -1px; /* Pegarlo al input */
    position: relative;
    z-index: 1;
}

.reply-indicator button {
    background: none;
    border: none;
    color: #1976d2;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
}

.mention-link {
    color: #1976d2;
    font-weight: 600;
    text-decoration: none;
}

.mention-link:hover {
    text-decoration: underline;
}

/* Ajuste visual para el input cuando se está respondiendo */
.comment-form.replying .comment-input {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    border-top: 1px solid #bbdefb;
}

/* --- FIN NUEVOS ESTILOS --- */

.stars {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  z-index: -1;
  pointer-events: none;
  display: none;
}

.star {
  position: absolute;
  background: #fff;
  border-radius: 50%;
  animation: twinkle 5s infinite, move 20s linear infinite;
  opacity: 0.8;
}

.star:nth-child(odd) {
  width: 2px;
  height: 2px;
}

.star:nth-child(even) {
  width: 1px;
  height: 1px;
}

@keyframes twinkle {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 0.3; }
}

@keyframes move {
  0% { transform: translateY(0) translateX(0); }
  100% { transform: translateY(100vh) translateX(10vw); }
}

header {
  background-color: #000;
  color: #fff;
  padding: 20px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: fixed;
  top: 0;
  width: 100%;
  box-sizing: border-box;
  z-index: 5000;
}

.logo {
  font-size: 32px;
  font-weight: bold;
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}

.logo:hover {
  color: #e0e0e0;
}

.header-icons {
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
  z-index: 2000;
}

.header-icons input {
  padding: 6px 12px;
  border-radius: 15px;
  border: none;
  outline: none;
  font-size: 16px;
  font-family: Arial, sans-serif;
  font-weight: normal;
  background-color: #fff;
  color: #000;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.header-icons input::placeholder {
  color: #000;
  opacity: 0.7;
}

.icon-button {
  background-color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 18px;
  color: #000;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: background-color 0.3s ease, color 0.3s ease;
  position: relative;
}

.icon-button:hover {
  background-color: #e0e0e0;
}

#theme-toggle {
  background-color: #fff;
  color: #000;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease, color 0.3s ease;
  border: none;
  z-index: 2;
}

#theme-toggle:hover {
  background-color: #e0e0e0;
}

.perfil-menu, .language-menu, .categorias-menu {
  position: relative;
  display: inline-block;
}

.menu-desplegable, .language-desplegable, .categorias-desplegable {
  display: none;
  position: absolute;
  right: 0;
  top: 50px;
  background-color: #ffffff;
  border-radius: 8px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  min-width: 200px;
  z-index: 2000;
  padding: 8px 0;
  font-family: 'Segoe UI', sans-serif;
  animation: slideDown 0.3s ease-in-out;
  border: 1px solid #e0e0e0;
  transition: background-color 0.3s ease, border-color 0.3s ease, opacity 0.3s ease;
}

.language-desplegable {
  min-width: 150px;
  top: 40px;
}

.categorias-desplegable {
  left: 0;
  top: 40px;
  width: 250px;
}

.menu-desplegable::before, .language-desplegable::before, .categorias-desplegable::before {
  content: '';
  position: absolute;
  top: -10px;
  right: 14px;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent #ffffff transparent;
  transition: border-color 0.3s ease;
}

.categorias-desplegable::before {
  left: 14px;
}

.menu-desplegable a, .menu-desplegable button, .language-desplegable button, .categorias-desplegable button {
  color: #333333;
  padding: 12px 16px;
  text-decoration: none;
  display: flex;
  align-items: center;
  font-size: 15px;
  font-weight: 500;
  gap: 12px;
  transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  cursor: pointer;
}

.menu-desplegable a:hover, .menu-desplegable button:hover, .language-desplegable button:hover, .categorias-desplegable button:hover {
  background-color: #e3f2fd;
  color: #1976d2;
  transform: translateX(4px);
}

.menu-desplegable a i, .menu-desplegable button i, .language-desplegable button i, .categorias-desplegable button i {
  font-size: 16px;
  color: #555555;
  transition: color 0.2s ease;
}

.menu-desplegable a:hover i, .menu-desplegable button:hover i, .language-desplegable button:hover i, .categorias-desplegable button:hover i {
  color: #1976d2;
}

.menu-desplegable a:not(:last-child), .menu-desplegable button:not(:last-child), .language-desplegable button:not(:last-child), .categorias-desplegable button:not(:last-child) {
  border-bottom: 1px solid #e0e0e0;
}

.logout-form {
  margin: 0;
  padding: 0;
  display: contents;
}

.categorias-desplegable ul {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 200px;
  overflow-y: auto;
}

.categorias-desplegable li {
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #333333;
  transition: background-color 0.2s ease, color 0.2s ease;
  cursor: pointer;
}

.categorias-desplegable li:hover {
  background-color: #e3f2fd;
  color: #1976d2;
}

.categorias-desplegable li input[type="checkbox"] {
  margin: 0;
  cursor: pointer;
}

.categorias-desplegable li label {
  cursor: pointer;
  flex: 1;
}

#otra-categoria {
  padding: 10px 16px;
  display: none;
}

#otra-categoria input {
  width: 100%;
  padding: 8px;
  border-radius: 4px;
  border: 1px solid #ccc;
  font-size: 14px;
  background-color: #fff;
  color: #000;
  box-sizing: border-box;
  transition: border-color 0.3s ease, background-color 0.3s ease;
}

#otra-categoria input:focus {
  border-color: #000;
  outline: none;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.container {
  max-width: 1200px;
  margin: 100px auto 40px auto;
  padding: 20px;
  position: relative;
  z-index: 0;
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

.publicar {
  background-color: #fafafa;
  padding: 20px 30px;
  border-radius: 10px;
  margin-bottom: 30px;
  border: 1px solid #ccc;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  flex: 1;
  min-width: 300px;
}

.filtros-categorias {
  background-color: #fafafa;
  padding: 20px;
  border-radius: 10px;
  border: 1px solid #ccc;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  flex: 0 0 250px;
  min-width: 200px;
  height: fit-content;
  position: relative;
  z-index: 1000;
}

.categoria-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.categoria-buttons .icon-button {
  font-size: 16px;
  padding: 8px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.categoria-buttons .icon-button.active {
  background-color: #1976d2;
  color: #fff;
}

.categoria-buttons .icon-button.active:hover {
  background-color: #1565c0;
}

.content-input {
  width: 100%;
  min-height: 80px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: Arial, sans-serif;
  font-size: 16px;
  font-weight: normal;
  line-height: 1.5;
  box-sizing: border-box;
  text-align: left;
  max-width: 100%;
  background-color: #fff;
  color: #000;
  transition: background-color 0.3s ease, color 0.3s ease;
  overflow-y: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.content-input:empty:before {
  content: attr(data-placeholder);
  color: #999;
  pointer-events: none;
  display: block;
}

.content-input:focus {
  outline: none;
  border-color: #000;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}

.preview-area {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}

.publicar button[type="submit"] {
  margin-top: 10px;
  padding: 10px 20px;
  border: none;
  background-color: #000;
  color: #fff;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.feed {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 100%;
}

.post {
  background-color: #fafafa;
  padding: 20px;
  border-radius: 10px;
  border: 1px solid #ccc;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  position: relative;
}

.post-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.post-profile-pic-container {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background-color: #e0e0e0;
}

.post-profile-pic {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.post-profile-icon {
  font-size: 24px;
  color: #666;
}

.post-user-info {
  display: flex;
  flex-direction: column;
}

.post-user-info .company-name {
  font-size: 16px;
  font-weight: bold;
  color: #000;
  margin: 0;
  transition: color 0.3s ease;
}

.post-content {
  max-height: 4.5em;
  line-height: 1.5em;
  overflow: hidden;
  transition: max-height 0.3s ease;
  position: relative; 
}

.post-content.expanded {
  max-height: none;
}

.post-content p {
  margin: 0 0 10px;
  font-size: 16px;
  color: #000;
  line-height: 1.5;
  transition: color 0.3s ease;
}

.read-more {
  color: #1976d2;
  font-size: 14px;
  cursor: pointer;
  margin-top: 5px;
  display: inline-block !important; 
  padding: 5px; 
  z-index: 100; 
  position: relative; 
}

.read-more:hover {
  color: #1565c0;
}

.post-media {
  margin-top: 10px;
}

.post-media img, .post-media video {
  max-width: 25%;
  height: auto;
  border-radius: 8px;
  display: block;
}

.post-meta p {
  margin: 10px 0 0;
  font-size: 14px;
  color: #666;
  transition: color 0.3s ease;
}

.post-meta p:last-child {
  font-size: 12px;
  color: #999;
}

.interested-count {
  margin-left: 10px;
  font-size: 14px;
  color: #666;
  transition: color 0.3s ease;
  display: inline-block;
  vertical-align: middle;
}

.delete-button {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #f44336;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 5px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
}

.delete-button:hover {
  background-color: #d32f2f;
}

.delete-button i {
  margin: 0;
}

.interest-button {
  background-color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 14px;
  color: #000;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: background-color 0.3s ease, color 0.3s ease;
  margin-top: 10px;
}

.interest-button:hover {
  background-color: #e0e0e0;
}

.interest-button.interested {
  background-color: #4caf50;
  color: #fff;
}

.interest-button.interested:hover {
  background-color: #45a049;
}

.interest-button.interested i {
  color: #fff;
}

.comments-section {
  margin-top: 15px;
  border-top: 1px solid #e0e0e0;
  padding-top: 10px;
  transition: border-color 0.3s ease;
}

.comment-form {
  display: flex;
  flex-direction: column; /* Cambiado para soportar el indicador */
  gap: 0;
  margin-bottom: 10px;
}

.comment-input-wrapper {
    display: flex;
    gap: 10px;
    width: 100%;
}

.comment-input {
  flex: 1;
  padding: 8px;
  border-radius: 15px;
  border: 1px solid #ccc;
  font-size: 14px;
  background-color: #fff;
  color: #000;
  transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
}

.comment-input:focus {
  border-color: #000;
  outline: none;
}

.comment-submit {
  background-color: #000;
  color: #fff;
  border: none;
  border-radius: 15px;
  padding: 8px 15px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.comment-submit:hover {
  background-color: #333;
}

.comments-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 200px;
  overflow-y: auto;
}

.comment {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  position: relative;
  padding: 5px 0;
}

.comment-profile-pic-container {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 1px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background-color: #e0e0e0;
}

.comment-profile-pic {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.comment-profile-icon {
  font-size: 18px;
  color: #666;
}

.comment-content {
  flex: 1;
}

.comment-user {
  font-size: 14px;
  font-weight: bold;
  color: #000;
  margin: 0;
  transition: color 0.3s ease;
}

.comment-text {
  font-size: 14px;
  color: #333;
  margin: 2px 0 0;
  transition: color 0.3s ease;
}

.comment-meta {
  font-size: 12px;
  color: #999;
  margin-top: 2px;
}

.comment-delete {
  position: absolute;
  top: 5px;
  right: 0;
  background-color: #f44336;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 2px;
  font-size: 12px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
}

.comment-delete:hover {
  background-color: #d32f2f;
}

.load-more-comments {
  font-size: 14px;
  color: #1976d2;
  cursor: pointer;
  text-align: center;
  margin-top: 10px;
  transition: color 0.3s ease;
}

.load-more-comments:hover {
  color: #1565c0;
}

.notification {
  position: fixed;
  top: 10px;
  right: 20px;
  background-color: #4caf50;
  color: white;
  padding: 15px 20px;
  border-radius: 8px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  z-index: 6000;
  display: none;
  align-items: center;
  gap: 10px;
  font-size: 16px;
  border: 1px solid #e0e0e0;
  transition: background-color 0.3s ease, border-color 0.3s ease, opacity 0.3s ease;
}

.notification.error {
  background-color: #f44336;
}

.notification.active {
  display: flex;
  animation: slideDown 0.3s ease-in-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(100%); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideOut {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(100%); }
}

.preview-wrapper {
  position: relative;
  display: inline-block;
}

.preview-image, .preview-video {
  width: 50px;
  height: 50px;
  border-radius: 4px;
  border: 1px solid #ccc;
  object-fit: cover;
  vertical-align: middle;
  transition: border-color 0.3s ease;
}

.remove-preview {
  position: absolute;
  top: -8px;
  right: -8px;
  background-color: #f44336;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  font-size: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease;
}

.remove-preview:hover {
  background-color: #d32f2f;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  animation: fadeIn 0.2s ease-in-out;
}

.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  text-align: center;
  max-width: 400px;
  width: 90%;
  color: #000;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.modal-content p {
  margin: 0 0 20px;
  font-size: 16px;
}

.modal-content button {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: pointer;
  margin: 0 10px;
  transition: background-color 0.3s ease;
}

#confirm-btn {
  background: #f44336;
  color: white;
}

#confirm-btn:hover {
  background: #d32f2f;
}

#cancel-btn {
  background: #ccc;
  color: black;
}

#cancel-btn:hover {
  background: #bbb;
}

.etiquetas-preview {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-left: 10px;
  align-items: center;
}

.etiqueta-pill {
  background-color: #e3f2fd;
  color: #1976d2;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.etiqueta-pill .remove-etiqueta {
  background: none;
  border: none;
  color: #1976d2;
  font-size: 12px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.etiqueta-pill .remove-etiqueta:hover {
  color: #d32f2f;
}

.notification-counter {
  position: absolute;
  top: -8px;
  right: -8px;
  background-color: #f44336;
  color: #fff;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease;
}

.notifications-desplegable {
  display: none;
  position: absolute;
  right: 0;
  top: 50px;
  background-color: #ffffff;
  border-radius: 8px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  width: 300px;
  max-height: 400px;
  overflow-y: auto;
  z-index: 4000;
  padding: 8px 0;
  font-family: 'Segoe UI', sans-serif;
  animation: slideDown 0.3s ease-in-out;
  border: 1px solid #e0e0e0;
  transition: background-color 0.3s ease, border-color 0.3s ease, opacity 0.3s ease;
}

.notifications-desplegable::before {
  content: '';
  position: absolute;
  top: -10px;
  right: 14px;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent #ffffff transparent;
  transition: border-color 0.3s ease;
}

.notifications-header {
  padding: 12px 16px;
  font-size: 16px;
  font-weight: bold;
  color: #333;
  border-bottom: 1px solid #e0e0e0;
  transition: color 0.3s ease, border-color 0.3s ease;
}

.notifications-list {
  max-height: 300px;
  overflow-y: auto;
}

.notification-item {
  padding: 12px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  color: #333;
  transition: background-color 0.2s ease, color 0.2s ease;
  cursor: pointer;
  border-bottom: 1px solid #e0e0e0;
}

.notification-item.unread {
  background-color: #e3f2fd;
  font-weight: 500;
}

.notification-item:hover {
  background-color: #f5f5f5;
}

.notification-item i {
  font-size: 16px;
  color: #555;
}

.notification-item.unread i {
  color: #1976d2;
}

.notification-item span {
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.load-more-notifications {
  display: block;
  width: 100%;
  padding: 10px;
  border: none;
  background: none;
  color: #1976d2;
  font-size: 14px;
  text-align: center;
  cursor: pointer;
  transition: color 0.2s ease;
}

.load-more-notifications:hover {
  color: #1565c0;
}

.filter-title {
  font-size: 18px;
  font-weight: 600;
  margin: 0 0 15px 0;
  text-align: center;
  color: #000;
  transition: color 0.3s ease;
}

body.dark-mode {
  background-color: #000;
  color: #fff;
}

body.dark-mode .comment.reply {
    background-color: rgba(255,255,255,0.05);
    border-left: 2px solid #333;
}

body.dark-mode .reply-btn {
    color: #999;
}

body.dark-mode .reply-btn:hover {
    color: #90caf9;
}

body.dark-mode .reply-indicator {
    background-color: #1e1e1e;
    color: #90caf9;
    border: 1px solid #333;
}

body.dark-mode .reply-indicator button {
    color: #90caf9;
}

body.dark-mode .mention-link {
    color: #90caf9;
}

body.dark-mode .comment-form.replying .comment-input {
    border-top: 1px solid #333;
}

body.dark-mode .stars {
  display: block;
}

body.dark-mode .header-icons input {
  background-color: #000;
  color: #fff;
}

body.dark-mode .header-icons input::placeholder {
  color: #fff;
  opacity: 0.7;
}

body.dark-mode .icon-button {
  background-color: #000;
  color: #fff;
}

body.dark-mode .icon-button:hover {
  background-color: #222;
}

body.dark-mode #theme-toggle {
  background-color: #000;
  color: #fff;
}

body.dark-mode #theme-toggle:hover {
  background-color: #222;
}

body.dark-mode .menu-desplegable, body.dark-mode .language-desplegable, body.dark-mode .categorias-desplegable {
  background-color: #2a2a2a;
  border: 1px solid #444444;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
}

body.dark-mode .menu-desplegable::before, body.dark-mode .language-desplegable::before, body.dark-mode .categorias-desplegable::before {
  border-color: transparent transparent #2a2a2a transparent;
}

body.dark-mode .menu-desplegable a, body.dark-mode .menu-desplegable button, body.dark-mode .language-desplegable button, body.dark-mode .categorias-desplegable button {
  color: #e0e0e0;
}

body.dark-mode .menu-desplegable a:hover, body.dark-mode .menu-desplegable button:hover, body.dark-mode .language-desplegable button:hover, body.dark-mode .categorias-desplegable button:hover {
  background-color: #3a3a3a;
  color: #90caf9;
}

body.dark-mode .menu-desplegable a i, body.dark-mode .menu-desplegable button i, body.dark-mode .language-desplegable button i, body.dark-mode .categorias-desplegable button i {
  color: #aaaaaa;
}

body.dark-mode .menu-desplegable a:hover i, body.dark-mode .menu-desplegable button:hover i, body.dark-mode .language-desplegable button:hover i, body.dark-mode .categorias-desplegable button:hover i {
  color: #90caf9;
}

body.dark-mode .menu-desplegable a:not(:last-child), body.dark-mode .menu-desplegable button:not(:last-child), body.dark-mode .language-desplegable button:not(:last-child), body.dark-mode .categorias-desplegable button:not(:last-child) {
  border-bottom: 1px solid #444444;
}

body.dark-mode .categorias-desplegable li {
  color: #e0e0e0;
}

body.dark-mode .categorias-desplegable li:hover {
  background-color: #3a3a3a;
  color: #90caf9;
}

body.dark-mode #otra-categoria input {
  background-color: #222;
  color: #fff;
  border-color: #444;
}

body.dark-mode .publicar {
  background-color: #000;
  border: 1px solid #333;
  box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
}

body.dark-mode .filtros-categorias {
  background-color: #000;
  border: 1px solid #333;
  box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
}

body.dark-mode .content-input {
  background-color: #fff;
  color: #000;
}

body.dark-mode .preview-area {
  background-color: #000;
}

body.dark-mode .publicar button {
  background-color: #000;
  color: #fff;
}

body.dark-mode .post {
  background-color: #000;
  border: 1px solid #333;
  box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
}

body.dark-mode .post-user-info .company-name {
  color: #fff;
}

body.dark-mode .post-content p {
  color: #fff;
}

body.dark-mode .read-more {
  color: #90caf9;
}

body.dark-mode .read-more:hover {
  color: #64b5f6;
}

body.dark-mode .post-meta p {
  color: #bbb;
}

body.dark-mode .post-meta p:last-child {
  color: #888;
}

body.dark-mode .interested-count {
  color: #bbb;
}

body.dark-mode .interest-button {
  background-color: #333;
  color: #fff;
}

body.dark-mode .interest-button:hover {
  background-color: #555;
}

body.dark-mode .interest-button.interested {
  background-color: #4caf50;
  color: #fff;
}

body.dark-mode .interest-button.interested:hover {
  background-color: #45a049;
}

body.dark-mode .comments-section {
  border-top: 1px solid #444;
}

body.dark-mode .comment-input {
  background-color: #222;
  color: #fff;
  border-color: #444;
}

body.dark-mode .comment-submit {
  background-color: #333;
  color: #fff;
}

body.dark-mode .comment-submit:hover {
  background-color: #555;
}

body.dark-mode .comment-user {
  color: #fff;
}

body.dark-mode .comment-text {
  color: #e0e0e0;
}

body.dark-mode .comment-meta {
  color: #888;
}

body.dark-mode .comment-profile-pic-container {
  border-color: #444;
  background-color: #333;
}

body.dark-mode .load-more-comments {
  color: #90caf9;
}

body.dark-mode .load-more-notifications {
  color: #90caf9;
}

body.dark-mode .load-more-notifications:hover {
  color: #64b5f6;
}

body.dark-mode .notification-counter {
  background-color: #d32f2f;
}

body.dark-mode .notifications-desplegable {
  background-color: #2a2a2a;
  border: 1px solid #444444;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
}

body.dark-mode .notifications-desplegable::before {
  border-color: transparent transparent #2a2a2a transparent;
}

body.dark-mode .notifications-header {
  color: #e0e0e0;
  border-bottom: 1px solid #444444;
}

body.dark-mode .notification-item {
  color: #e0e0e0;
  border-bottom: 1px solid #444444;
}

body.dark-mode .notification-item.unread {
  background-color: #3a3a3a;
}

body.dark-mode .notification-item:hover {
  background-color: #333333;
}

body.dark-mode .notification-item i {
  color: #aaaaaa;
}

body.dark-mode .notification-item.unread i {
  color: #90caf9;
}

body.dark-mode .load-more-notifications {
  color: #90caf9;
}

body.dark-mode .load-more-notifications:hover {
  color: #64b5f6;
}

body.dark-mode .notification {
  background-color: #4caf50;
  border: 1px solid #444444;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
}

body.dark-mode .notification.error {
  background-color: #f44336;
}

body.dark-mode .preview-image, body.dark-mode .preview-video {
  border-color: #555;
}

body.dark-mode .etiquetas-preview .etiqueta-pill {
  background-color: #222;
  color: #90caf9;
}

body.dark-mode .etiqueta-pill .remove-etiqueta {
  color: #90caf9;
}

body.dark-mode .etiqueta-pill .remove-etiqueta:hover {
  color: #d32f2f;
}

body.dark-mode .modal-content {
  background: #222;
  color: #fff;
}

body.dark-mode .filter-title {
  color: #fff;
}
/* --- NUEVOS ESTILOS: MENÚ Y REPORTE --- */
.post-header { position: relative; display: flex; align-items: center; }
.post-options { margin-left: auto; position: relative; }

.options-btn { 
    background: transparent; border: none; font-size: 18px; cursor: pointer; 
    padding: 8px; border-radius: 50%; width: 35px; height: 35px; 
    display: flex; align-items: center; justify-content: center; color: #666; 
}
.options-btn:hover { background-color: #e0e0e0; color: #000; }

.post-dropdown-menu { 
    display: none; position: absolute; right: 0; top: 40px; 
    background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; width: 180px; overflow: hidden; 
}
.post-dropdown-menu.show { display: block; animation: slideDown 0.2s ease; }

.dropdown-item { 
    display: flex; align-items: center; gap: 10px; width: 100%; padding: 12px 15px; 
    border: none; background: none; text-align: left; cursor: pointer; font-size: 14px; color: #333; 
}
.dropdown-item:hover { background-color: #f5f5f5; color: #1976d2; }
.dropdown-item.danger { color: #d32f2f; }
.dropdown-item.danger:hover { background-color: #ffebee; }

/* Estilos Modal Reporte (Para que se vea bien) */
#report-modal .modal-content { text-align: left; padding: 20px; }
.report-options { display: flex; flex-direction: column; gap: 10px; margin: 15px 0; }
.report-option { 
    display: flex; align-items: center; gap: 10px; padding: 10px; 
    border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer; background: #fff; 
}
.report-option:hover { background-color: #f9f9f9; border-color: #999; }
.report-option span { color: #333; font-weight: 500; }

/* Ajuste Dark Mode */
body.dark-mode .post-dropdown-menu { background-color: #2a2a2a; border-color: #444; }
body.dark-mode .dropdown-item { color: #e0e0e0; }
body.dark-mode .dropdown-item:hover { background-color: #3a3a3a; }
body.dark-mode .report-option { background-color: #2a2a2a; border-color: #444; }
body.dark-mode .report-option:hover { background-color: #333; }
body.dark-mode .report-option span { color: #fff; }

/* Ajustes para móviles */
@media (max-width: 768px) {
  .container {
    margin: 80px 10px 20px 10px;
    padding: 10px;
    flex-direction: column;
  }

  header {
    padding: 10px 20px;
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .logo {
    font-size: 24px;
  }

  .header-icons {
    width: 100%;
    justify-content: space-between;
    gap: 5px;
  }

  .header-icons input {
    width: 100%;
    font-size: 14px;
    padding: 8px;
  }

  .icon-button {
    padding: 6px;
    font-size: 16px;
  }

  #theme-toggle {
    padding: 6px;
    font-size: 16px;
  }

  .menu-desplegable, .language-desplegable, .categorias-desplegable, .notifications-desplegable {
    width: 100%;
    max-width: 250px;
    right: 0;
    top: 45px;
  }

  .menu-desplegable::before, .language-desplegable::before, .categorias-desplegable::before, .notifications-desplegable::before {
    right: 10px;
  }

  .categorias-desplegable {
    left: auto;
    width: 100%;
    max-height: 300px;
  }

  .publicar {
    padding: 15px;
    min-width: 100%;
  }

  .content-input {
    font-size: 14px;
    min-height: 60px;
  }

  .action-buttons {
    justify-content: space-between;
  }

  .action-buttons .icon-button {
    padding: 6px;
    font-size: 14px;
  }

  .filtros-categorias {
    flex: 1;
    min-width: 100%;
    padding: 15px;
  }

  .categoria-buttons {
    gap: 5px;
  }

  .categoria-buttons .icon-button {
    width: 35px;
    height: 35px;
    font-size: 14px;
  }

  .filter-title {
    font-size: 16px;
  }

  .post {
    padding: 15px;
  }

  .post-header {
    gap: 8px;
  }

  .post-profile-pic-container {
    width: 35px;
    height: 35px;
  }

  .post-user-info .company-name {
    font-size: 14px;
  }

  .post-content p {
    font-size: 14px;
  }

  .post-media img, .post-media video {
    max-width: 100%;
  }

  .post-meta p {
    font-size: 12px;
  }

  .interest-button {
    font-size: 12px;
    padding: 6px 10px;
  }

  .interested-count {
    font-size: 12px;
  }

  .comment-form {
    flex-direction: column;
    gap: 5px;
  }

  .comment-input {
    width: 100%;
    font-size: 12px;
    padding: 6px;
  }

  .comment-submit {
    width: 100%;
    font-size: 12px;
    padding: 6px;
  }

  .comment-profile-pic-container {
    width: 25px;
    height: 25px;
  }

  .comment-user {
    font-size: 12px;
  }

  .comment-text {
    font-size: 12px;
  }

  .comment-meta {
    font-size: 10px;
  }

  .notification {
    top: 5px;
    right: 10px;
    padding: 10px;
    font-size: 14px;
    max-width: 90%;
  }

  .notifications-desplegable {
    width: 100%;
    max-width: 300px;
    top: 45px;
  }

  .modal-content {
    padding: 15px;
    max-width: 90%;
  }

  .modal-content p {
    font-size: 14px;
  }

  .modal-content button {
    font-size: 14px;
    padding: 8px 15px;
  }
}

/* Ajustes para pantallas muy pequeñas */
@media (max-width: 480px) {
  .logo {
    font-size: 20px;
  }

  .header-icons input {
    font-size: 12px;
    padding: 6px;
  }

  .icon-button {
    padding: 5px;
    font-size: 14px;
  }

  #theme-toggle {
    padding: 5px;
    font-size: 14px;
  }

  .publicar {
    padding: 10px;
  }

  .content-input {
    font-size: 12px;
  }

  .action-buttons .icon-button {
    padding: 5px;
    font-size: 12px;
  }

  .filtros-categorias {
    padding: 10px;
  }

  .categoria-buttons .icon-button {
    width: 30px;
    height: 30px;
    font-size: 12px;
  }

  .filter-title {
    font-size: 14px;
  }

  .post {
    padding: 10px;
  }

  .post-content p {
    font-size: 12px;
  }

  .post-media img, .post-media video {
    max-width: 100%;
  }

  .post-meta p {
    font-size: 10px;
  }

  .interest-button {
    font-size: 10px;
    padding: 5px 8px;
  }

  .interested-count {
    font-size: 10px;
  }

  .notification {
    font-size: 12px;
    padding: 8px;
  }
}
/* --- NUEVOS ESTILOS: VISOR MULTIMEDIA Y CORRECCIÓN TEXTO --- */

/* Corrección para cortar texto a 3 líneas */
.post-content {
  max-height: 4.5em; /* Aproximadamente 3 líneas */
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  text-overflow: ellipsis;
  transition: max-height 0.3s ease;
}

.post-content.expanded {
  max-height: none;
  -webkit-line-clamp: unset;
  line-clamp: unset;
  overflow: visible;
}

/* Estilos para el Visor Multimedia (Lightbox) */
#media-viewer {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.95);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#media-viewer.active {
  display: flex;
}

#media-viewer-content {
  max-width: 90%;
  max-height: 80%;
  object-fit: contain;
  transition: transform 0.3s ease;
}

/* Controles del visor */
.viewer-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 15px;
  z-index: 10000;
}

.viewer-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255,255,255,0.5);
  color: white;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: background 0.3s;
}

.viewer-btn:hover {
  background: rgba(255, 255, 255, 0.4);
}

/* Cursor pointer para las imágenes en el feed */
/* --- CORRECCIÓN TAMAÑO MULTIMEDIA --- */
.post-media img, .post-media video {
  width: 100%;       /* Ocupa el ancho disponible del post */
  height: auto;      /* Mantiene la proporción */
  max-height: 500px; /* Límite de altura para que no ocupe toda la pantalla */
  object-fit: cover; /* Recorta bonito si sobra imagen */
  border-radius: 8px;
  display: block;
  cursor: pointer;
  margin-top: 10px;
}

/* --- NUEVO CSS PARA MINIATURAS DE VIDEO TIPO FACEBOOK --- */

/* Contenedor relativo para poder centrar el botón absolutamente dentro de él */
/* --- CORRECCIÓN PARA CENTRADO DE ICONO --- */

/* Contenedor relativo para el video */
/* Contenedor relativo para el video */
.video-thumbnail-container {
    position: relative;
    display: flex; 
    justify-content: center;
    align-items: center;
    width: 100%;
    /* Eliminamos el background-color: #000 para que no haya bordes negros */
    background-color: transparent; 
    cursor: pointer;
    margin-top: 10px;
    border-radius: 8px;
    overflow: hidden;
}

/* El video se ajustará a su tamaño real sin rellenos */
.video-thumbnail-container video {
    width: 100%;
    height: auto;
    max-height: 500px;
    display: block;
    /* 'contain' asegura que se vea toda la imagen, pero 'initial' o 
       simplemente no forzar el fondo negro hará que se vea limpio */
    object-fit: contain; 
}

/* El círculo del botón Play (Centro Absoluto) */
.play-icon-overlay {
    position: absolute;
    /* Las siguientes 4 líneas garantizan el centro exacto */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); 
    
    width: 70px;
    height: 70px;
    background-color: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid #fff;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
    z-index: 10; /* Asegura que esté por encima del video */
    pointer-events: none;
}

/* Efecto Hover */
.video-thumbnail-container:hover .play-icon-overlay {
    background-color: rgba(255, 0, 0, 0.8);
    transform: translate(-50%, -50%) scale(1.1);
    border-color: #fff;
}

/* Asegurar que el botón ver más se vea */
/* Busca y reemplaza tu clase .read-more por esta */
.read-more {
  display: none; /* Oculto por defecto */
  color: #1976d2;
  font-size: 14px;
  cursor: pointer;
  margin-top: 5px;
  padding: 5px; 
  z-index: 100; 
  position: relative; 
  font-weight: 600;
}

/* Agregamos esta clase para mostrarlo mediante JS */
.read-more.visible {
  display: inline-block;
}

</style>

</head>
<body>
  <div class="stars"></div>

  <header>
    <a href="/inicio.html" class="logo" data-translate="inicio.logo" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); window.location.reload();">PrendiaX</a>
    <div class="header-icons">
      <input type="text" placeholder="Buscar en PrendiaX" id="buscador" oninput="search()" data-translate="inicio.search_placeholder" />
      <button class="icon-button" id="notifications-toggle" title="Notificaciones">
  <i class="fas fa-bell"></i>
  <span class="notification-counter" id="notification-counter" style="display: none;">0</span>
</button>
<div class="menu-desplegable notifications-desplegable" id="notifications-menu">
  <div class="notifications-header">
    <span data-translate="inicio.notifications_title">Notificaciones</span>
  </div>
  <div class="notifications-list" id="notifications-list">
    </div>
  <button class="load-more-notifications" id="load-more-notifications" style="display: none;" data-translate="inicio.load_more_notifications">Cargar más</button>
</div>
            <button class="icon-button" id="chats-toggle" title="Chats" onclick="window.location.href='chats.html'">
        <i class="fas fa-comment-dots"></i>
        <span class="notification-counter" id="chats-unread-counter" style="display: none;">0</span>
      </button>
      <button id="theme-toggle" title="Cambiar modo">
        <i class="fas fa-moon"></i> 
      </button>
      <div class="language-menu">
        <button class="icon-button" id="language-toggle" title="Cambiar idioma">
          <i class="fas fa-globe"></i> 
        </button>
        <div class="menu-desplegable language-desplegable" id="language-menu">
          <button data-lang="es"><i class="fas fa-language"></i> Español</button>
          <button data-lang="en"><i class="fas fa-language"></i> English</button>
        </div>
      </div>
      <div class="perfil-menu">
        <button class="icon-button" id="perfil-btn" title="Perfil">
          <i class="fas fa-user-circle"></i>
        </button>
        <div class="menu-desplegable" id="menu-perfil">
          <a href="/perfil" data-translate="inicio.profile_link">
            <i class="fas fa-user-tie"></i>
            <span>Perfil</span>
          </a>
          <form action="/salir" method="post" class="logout-form">
            <button type="submit" data-translate="inicio.logout">
              <i class="fas fa-door-open"></i>
              <span>Salir</span>
            </button>
          </form>
        </div>
      </div>
    </div>
      <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i>
      <span id="notification-message"></span>
  </header>

  <div class="container">
    <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i>
      <span id="notification-message"></span>
    </div>

    <div class="publicar">
      <form id="form-publicar" action="/publicar" method="post" enctype="multipart/form-data">
        <div id="content-input" contenteditable="true" class="content-input" data-placeholder="{{ 'inicio.post_placeholder' | translate }}"></div>
        <input type="hidden" name="contenido" id="contenido-hidden">
        <input type="hidden" name="etiquetas" id="etiquetas-hidden">
        <div id="preview-area" class="preview-area"></div>
        <div class="action-buttons">
          <button type="button" class="icon-button" title="Agregar imagen" onclick="document.getElementById('imagen').click()">
            <i class="fas fa-image"></i>
          </button>
          <input type="file" id="imagen" name="imagen" accept="image/*" style="display: none" />
          <button type="button" class="icon-button" title="Agregar video" onclick="document.getElementById('video').click()">
            <i class="fas fa-video"></i>
          </button>
          <input type="file" id="video" name="video" accept="video/*" style="display: none" />
          <div class="categorias-menu">
            <button type="button" class="icon-button" id="categorias-toggle" title="Agregar categorías">
              <i class="fas fa-tags"></i>
            </button>
            <div class="etiquetas-preview" id="etiquetas-preview"></div>
            <div class="categorias-desplegable" id="categorias-menu">
              <ul>
                <li>
                  <input type="checkbox" id="cat-1" name="categorias" value="Restaurantes y comida rápida">
                  <label for="cat-1">Restaurantes y comida rápida</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-2" name="categorias" value="Alimentos y bebidas">
                  <label for="cat-2">Alimentos y bebidas</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-3" name="categorias" value="Ropa">
                  <label for="cat-3">Ropa</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-4" name="categorias" value="Artículos religiosos">
                  <label for="cat-4">Artículos religiosos</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-5" name="categorias" value="Tecnología y electrónica">
                  <label for="cat-5">Tecnología y electrónica</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-6" name="categorias" value="Servicios profesionales">
                  <label for="cat-6">Servicios profesionales</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-7" name="categorias" value="Salud y bienestar">
                  <label for="cat-7">Salud y bienestar</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-8" name="categorias" value="Créditos y servicios financieros">
                  <label for="cat-8">Créditos y servicios financieros</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-9" name="categorias" value="Bienes raíces">
                  <label for="cat-9">Bienes raíces</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-10" name="categorias" value="Entretenimiento y eventos">
                  <label for="cat-10">Entretenimiento y eventos</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-11" name="categorias" value="Educación">
                  <label for="cat-11">Educación</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-12" name="categorias" value="Mascotas y veterinarias">
                  <label for="cat-12">Mascotas y veterinarias</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-13" name="categorias" value="Productos artesanales o locales">
                  <label for="cat-13">Productos artesanales o locales</label>
                </li>
                <li>
                  <input type="checkbox" id="cat-otro" name="categorias" value="otro">
                  <label for="cat-otro">Otro</label>
                </li>
              </ul>
              <button type="button" id="categorias-listo" class="icon-button">Listo</button>
              <div id="otra-categoria">
                <input type="text" id="otra-categoria-input" name="otra_categoria" placeholder="Especificar categoría" data-translate="inicio.other_category_placeholder" />
              </div>
            </div>
          </div>
        </div>
        <button type="submit" data-translate="inicio.post_button">Publicar</button>
      </form>
    </div>
<div class="filtros-categorias">
  <h3 class="filter-title" data-translate="inicio.filter_title">Filtrar feed por categoría</h3>
  <div class="categoria-buttons">
    <button class="icon-button categoria-filter" data-categoria="Restaurantes y comida rápida" title="Restaurantes y comida rápida">
      <i class="fas fa-utensils"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Alimentos y bebidas" title="Alimentos y bebidas">
      <i class="fas fa-coffee"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Ropa" title="Ropa">
      <i class="fas fa-tshirt"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Artículos religiosos" title="Artículos religiosos">
      <i class="fas fa-cross"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Tecnología y electrónica" title="Tecnología y electrónica">
      <i class="fas fa-laptop"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Servicios profesionales" title="Servicios profesionales">
      <i class="fas fa-briefcase"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Salud y bienestar" title="Salud y bienestar">
      <i class="fas fa-heartbeat"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Créditos y servicios financieros" title="Créditos y servicios financieros">
      <i class="fas fa-money-bill"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Bienes raíces" title="Bienes raíces">
      <i class="fas fa-home"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Entretenimiento y eventos" title="Entretenimiento y eventos">
      <i class="fas fa-ticket-alt"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Educación" title="Educación">
      <i class="fas fa-graduation-cap"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Mascotas y veterinarias" title="Mascotas y veterinarias">
      <i class="fas fa-paw"></i>
    </button>
    <button class="icon-button categoria-filter" data-categoria="Productos artesanales o locales" title="Productos artesanales o locales">
  <i class="fas fa-hand-holding-heart"></i>
</button>
    </button>
    <button class="icon-button categoria-filter" data-categoria="" title="Mostrar todo">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</div>

    <div id="feed" class="feed"></div>
  </div>

  <div id="confirm-modal" class="modal">
    <div class="modal-content">
      <p id="modal-message" data-translate="inicio.delete_confirm">¿Estás seguro de que quieres eliminar esta publicación?</p>
      <button id="confirm-btn" data-translate="inicio.delete_button">Eliminar</button>
      <button id="cancel-btn" data-translate="inicio.cancel_button">Cancelar</button>
    </div>
  </div>
 <div id="report-modal" class="modal">
  <div class="modal-content">
    <h3 data-translate="inicio.report_title">Reportar publicación</h3>
    <p data-translate="inicio.report_subtitle">Selecciona un motivo:</p>
    <div class="report-options">
      <label class="report-option"><input type="radio" name="report-reason" value="Spam o fraude"> <span>Es spam o fraude</span></label>
      <label class="report-option"><input type="radio" name="report-reason" value="Contenido ofensivo"> <span>Contenido ofensivo</span></label>
      <label class="report-option"><input type="radio" name="report-reason" value="Información falsa"> <span>Información falsa</span></label>
      <label class="report-option"><input type="radio" name="report-reason" value="Venta ilegal"> <span>Venta ilegal</span></label>
    </div>
    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
      <button id="cancel-report-btn" style="background: #ccc; color: #000;">Cancelar</button>
      <button id="submit-report-btn" style="background: #f44336; color: #fff;">Enviar</button>
    </div>
  </div>
</div>
<div id="media-viewer">
  <div class="viewer-controls">
    <button class="viewer-btn" onclick="zoomMedia(0.2)" title="Zoom In"><i class="fas fa-search-plus"></i></button>
    <button class="viewer-btn" onclick="zoomMedia(-0.2)" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
    <button class="viewer-btn" onclick="closeMediaViewer()" title="Cerrar"><i class="fas fa-times"></i></button>
  </div>
  <div id="media-container" style="display: flex; justify-content: center; align-items: center; width: 100%; height: 100%;">
    </div>
</div>
  <script src="translations.js"></script>
  <script src="main.js?v=1"></script>
  <script>
// Estrellas para el modo oscuro
const stars = document.querySelector('.stars');
const numStars = 1000;

for (let i = 0; i < numStars; i++) {
  const star = document.createElement('div'); 
  star.classList.add('star');
  star.style.left = `${Math.random() * 100}vw`;
  star.style.top = '0';
  star.style.animationDelay = `${Math.random() * 5}s`;
  star.style.animationDuration = `${Math.random() * 10 + 10}s`;
  stars.appendChild(star);
}

// Configuración inicial del tema
let savedTheme = localStorage.getItem('theme') || 'light';
document.body.classList.toggle('dark-mode', savedTheme === 'dark');
const themeToggle = document.getElementById('theme-toggle');
themeToggle.innerHTML = savedTheme === 'dark'
  ? '<i class="fas fa-sun"></i>'
  : '<i class="fas fa-moon"></i>';

// Cambiar tema
themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  const lang = localStorage.getItem('language') || 'es';
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  themeToggle.innerHTML = isDark
    ? '<i class="fas fa-sun"></i>'
    : '<i class="fas fa-moon"></i>';
  updateLanguage(lang);
});

// Variables globales
let currentReportPostId = null;
let offset = 0;
const limit = 10;
let isLoading = false;
let hasMore = true;
let loadedPostIds = new Set();
let currentUserId = null;
let isSearching = false;
const commentLimit = 5;
const interestedPosts = new Set();
let notificationOffset = 0;
const notificationLimit = 10;
let notificationCount = 0;
let wsNotifications = null;
let replyState = {}; 

// --- LÓGICA DE MENÚ Y REPORTES ---
function togglePostMenu(postId, event) {
  event.stopPropagation();
  document.querySelectorAll('.post-dropdown-menu').forEach(m => {
    if(m.id !== `menu-post-${postId}`) m.classList.remove('show');
  });
  const menu = document.getElementById(`menu-post-${postId}`);
  if(menu) menu.classList.toggle('show');
}

window.addEventListener('click', () => {
  document.querySelectorAll('.post-dropdown-menu').forEach(m => m.classList.remove('show'));
});

function openReportModal(postId) {
  currentReportPostId = postId;
  document.querySelectorAll('input[name="report-reason"]').forEach(i => i.checked = false);
  document.getElementById('report-modal').style.display = 'flex';
  const menu = document.getElementById(`menu-post-${postId}`);
  if(menu) menu.classList.remove('show');
}

document.getElementById('cancel-report-btn').onclick = () => {
  document.getElementById('report-modal').style.display = 'none';
};

document.getElementById('submit-report-btn').onclick = async () => {
  if (!currentReportPostId) return;
  const selected = document.querySelector('input[name="report-reason"]:checked');
  if (!selected) return showNotification("Elige un motivo", true);

  try {
    const res = await fetch('/api/reportar/publicacion', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ publicacion_id: currentReportPostId, motivo: selected.value })
    });
    if (res.ok) {
      showNotification("Reporte enviado. Gracias.");
      document.getElementById('report-modal').style.display = 'none';
      const post = document.querySelector(`.post[data-post-id="${currentReportPostId}"]`);
      if(post) post.remove();
    }
  } catch (e) { showNotification("Error de conexión", true); }
};

// Formatear fechas
function formatDate(dateString, lang = 'es') {
  if (!dateString) return translations[lang].inicio.invalid_date || 'Fecha inválida';
  const date = luxon.DateTime.fromFormat(dateString, 'yyyy-MM-dd HH:mm:ss', { zone: 'utc' }).setZone('America/Chicago');
  if (!date.isValid) return translations[lang].inicio.invalid_date || 'Fecha inválida';
  const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: lang === 'en' };
  return date.toLocaleString(lang === 'es' ? 'es-ES' : 'en-US', options);
}

// Obtener ID del usuario actual
async function fetchCurrentUserId() {
  try {
    const response = await fetch('/current_user', {
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
    });
    if (!response.ok) {
      if (response.status === 401) {
        const profileLink = document.querySelector('#menu-perfil a[href="/perfil"]');
        profileLink.href = '/login';
        throw new Error('Usuario no autenticado');
      }
      throw new Error(`Error en la solicitud: ${response.status}`);
    }
    const data = await response.json();
    if (data.user_id !== null) {
      currentUserId = Number(data.user_id);
      const profileLink = document.querySelector('#menu-perfil a[href="/perfil"]');
      profileLink.href = data.tipo === 'explorador' ? '/perfil-especifico' : '/perfil';
    } else {
      const profileLink = document.querySelector('#menu-perfil a[href="/perfil"]');
      profileLink.href = '/login';
      showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_login_required, true);
    }
  } catch (error) {
    console.error('Error al obtener el usuario:', error);
    const profileLink = document.querySelector('#menu-perfil a[href="/perfil"]');
    profileLink.href = '/login';
    showNotification(translations[localStorage.getItem('language') || 'es'].inicio.profile_error, true);
  }
}

async function redirectToProfile(userId) {
  try {
    const response = await fetch(`/user/${userId}`, {
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
    });
    if (!response.ok) throw new Error(`Error en la solicitud: ${response.status}`);
    const data = await response.json();
    const profileUrl = data.tipo === 'emprendedor' ? `/perfil.html?user_id=${userId}` : `/perfil-especifico.html?user_id=${userId}`;
    window.location.href = profileUrl;
  } catch (error) {
    console.error('Error al obtener tipo de usuario:', error);
    showNotification(translations[localStorage.getItem('language') || 'es'].inicio.profile_error, true);
  }
}

// Actualizar idioma
function updateLanguage(lang) {
  document.querySelectorAll("[data-translate]").forEach(element => {
    const key = element.getAttribute("data-translate");
    const [page, textKey] = key.split('.');
    const translation = translations[lang][page][textKey];
    if (element.tagName === 'INPUT' && textKey.includes('placeholder')) {
      element.placeholder = translation;
    } else if (element.tagName === 'BUTTON' || element.tagName === 'A') {
      const span = element.querySelector('span');
      if (span) span.textContent = translation;
      else element.textContent = translation;
    } else {
      element.textContent = translation;
    }
  });
  document.documentElement.lang = lang;
  updatePlaceholder();

  document.querySelectorAll('.post-meta p[data-original-date]').forEach(p => {
    const originalDate = p.dataset.originalDate;
    p.textContent = originalDate ? formatDate(originalDate, lang) : translations[lang].inicio.invalid_date;
  });

  document.querySelectorAll('.comment-meta[data-original-date]').forEach(p => {
    const originalDate = p.dataset.originalDate;
    p.textContent = originalDate ? formatDate(originalDate, lang) : translations[lang].inicio.invalid_date;
  });

  // Asegurar que los botones "Ver más" mantengan su texto correcto según estado
  document.querySelectorAll('.read-more').forEach(button => {
    const isExpanded = button.previousElementSibling.classList.contains('expanded');
    button.textContent = isExpanded ? "Ver menos" : "Ver más";
  });
}

function updatePlaceholder() {
  const contentInput = document.getElementById('content-input');
  const lang = localStorage.getItem('language') || 'es';
  contentInput.setAttribute('data-placeholder', translations[lang].inicio.post_placeholder);
  document.querySelectorAll('.comment-input').forEach(input => {
    input.placeholder = translations[lang].inicio.comment_placeholder;
  });
}

function showNotification(message, isError = false) {
  const notification = document.getElementById('notification');
  const messageElement = document.getElementById('notification-message');
  if (notification.timeout) {
    clearTimeout(notification.timeout);
    clearTimeout(notification.displayTimeout);
  }
  notification.classList.remove('active', 'error');
  notification.style.opacity = '1';
  notification.style.display = 'flex';
  notification.innerHTML = '';
  const icon = document.createElement('i');
  icon.className = isError ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
  messageElement.textContent = message;
  notification.appendChild(icon);
  notification.appendChild(messageElement);
  if (isError) notification.classList.add('error');
  notification.offsetHeight;
  notification.classList.add('active');
  notification.timeout = setTimeout(() => {
    notification.classList.remove('active');
    notification.displayTimeout = setTimeout(() => {
      notification.style.display = 'none';
    }, 300);
  }, 2000);
}

function showConfirmModal(messageKey, onConfirm) {
  const modal = document.getElementById('confirm-modal');
  const messageElement = document.getElementById('modal-message');
  const lang = localStorage.getItem('language') || 'es';
  messageElement.textContent = translations[lang].inicio[messageKey];
  messageElement.setAttribute('data-translate', `inicio.${messageKey}`);
  modal.style.display = 'flex';
  const confirmBtn = document.getElementById('confirm-btn');
  const cancelBtn = document.getElementById('cancel-btn');
  confirmBtn.onclick = () => { onConfirm(); modal.style.display = 'none'; };
  cancelBtn.onclick = () => modal.style.display = 'none';
}

async function borrarPublicacion(postId, postElement) {
  showConfirmModal('delete_confirm', async () => {
    try {
      const response = await fetch(`/borrar_publicacion/${postId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
      });
      if (response.ok) {
        postElement.style.transition = 'opacity 0.3s';
        postElement.style.opacity = '0';
        setTimeout(() => { postElement.remove(); loadedPostIds.delete(postId); }, 300);
        showNotification(translations[localStorage.getItem('language') || 'es'].inicio.delete_success);
      } else {
        const data = await response.json();
        showNotification(`${translations[localStorage.getItem('language') || 'es'].inicio.delete_error}: ${data.detail}`, true);
      }
    } catch (error) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.delete_error_network, true); }
  });
}

async function borrarComentario(commentId, commentElement) {
  showConfirmModal('delete_comment_confirm', async () => {
    try {
      const response = await fetch(`/borrar_comentario/${commentId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
      });
      if (response.ok) {
        commentElement.style.transition = 'opacity 0.3s';
        commentElement.style.opacity = '0';
        setTimeout(() => commentElement.remove(), 300);
        showNotification(translations[localStorage.getItem('language') || 'es'].inicio.delete_comment_success);
      } else {
        const data = await response.json();
        showNotification(`${translations[localStorage.getItem('language') || 'es'].inicio.delete_comment_error}: ${data.detail}`, true);
      }
    } catch (error) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.delete_comment_error_network, true); }
  });
}

function prepareReply(postId, commentId, userId, userName) {
    const commentsSection = document.getElementById(`comments-${postId}`).parentElement;
    const inputWrapper = commentsSection.querySelector('.comment-form');
    const input = inputWrapper.querySelector('.comment-input');
    const indicator = inputWrapper.querySelector('.reply-indicator');
    const indicatorText = indicator.querySelector('span');
    replyState[postId] = { parent_id: commentId, reply_to_user_id: userId, userName: userName };
    indicator.style.display = 'flex';
    indicatorText.textContent = `Respondiendo a @${userName}`;
    inputWrapper.classList.add('replying');
    input.value = `@${userName} `;
    input.focus();
}

function cancelReply(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`).parentElement;
    const inputWrapper = commentsSection.querySelector('.comment-form');
    const input = inputWrapper.querySelector('.comment-input');
    const indicator = inputWrapper.querySelector('.reply-indicator');
    delete replyState[postId];
    indicator.style.display = 'none';
    inputWrapper.classList.remove('replying');
    input.value = '';
}

async function cargarComentarios(postId, commentsContainer, loadMoreLink, offset = 0) {
  try {
    const response = await fetch(`/publicacion/${postId}/comentarios?limit=${commentLimit}&offset=${offset}`, {
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
    });
    if (!response.ok) {
      if (response.status === 401) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_login_required, true); return; }
      throw new Error(`Error: ${response.status}`);
    }
    const comentarios = await response.json();
    const lang = localStorage.getItem('language') || 'es';
    if (!Array.isArray(comentarios.comentarios)) throw new Error("No es un array");
    const totalComments = comentarios.total || 0;
    const currentCount = commentsContainer.children.length + comentarios.comentarios.length;

    comentarios.comentarios.forEach(comentario => {
      const commentDiv = document.createElement('div');
      commentDiv.classList.add('comment');
      if (comentario.parent_id) commentDiv.classList.add('reply');
      let contenidoHtml = comentario.contenido;
      if (comentario.nombre_respondido) {
        const mentionRegex = new RegExp(`@${comentario.nombre_respondido}`, 'i');
        contenidoHtml = contenidoHtml.replace(mentionRegex, `<a href="#" class="mention-link">@${comentario.nombre_respondido}</a>`);
      }
      let commentContent = `
        <div class="comment-profile-pic-container">
          ${comentario.foto_perfil_url ? `<img src="${comentario.foto_perfil_url}" class="comment-profile-pic" onerror="this.parentNode.innerHTML = '<i class=\\'fas fa-user comment-profile-icon\\'></i>'">` : `<i class="fas fa-user comment-profile-icon"></i>`}
        </div>
        <div class="comment-content">
          <p class="comment-user" style="cursor: pointer;" onclick="redirectToProfile(${comentario.user_id})">${comentario.nombre_empresa}</p>
          <p class="comment-text">${contenidoHtml}</p>
          <div class="comment-actions">
            <span class="comment-meta">${formatDate(comentario.fecha_creacion, lang)}</span>
            <button class="reply-btn" onclick="prepareReply(${comentario.publicacion_id}, ${comentario.parent_id ? comentario.parent_id : comentario.id}, ${comentario.user_id}, '${comentario.nombre_empresa}')">Responder</button>
          </div>
        </div>
      `;
      if (currentUserId && comentario.user_id && Number(comentario.user_id) === Number(currentUserId)) {
        commentContent += `<button class="comment-delete" onclick="borrarComentario(${comentario.id}, this.parentElement)"><i class="fas fa-trash"></i></button>`;
      }
      commentDiv.innerHTML = commentContent;
      commentsContainer.appendChild(commentDiv);
    });
    loadMoreLink.style.display = currentCount < totalComments ? 'block' : 'none';
    loadMoreLink.dataset.offset = Number(loadMoreLink.dataset.offset || 0) + commentLimit;
  } catch (error) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comments_error, true); }
}

async function submitComment(postId, inputElement, commentsContainer) {
  if (!currentUserId) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_login_required, true); return; }
  const contenido = inputElement.value.trim();
  if (!contenido) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_empty_error, true); return; }
  const replyData = replyState[postId] || {};
  try {
    const response = await fetch(`/publicacion/${postId}/comentar`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ contenido: contenido, parent_id: replyData.parent_id || null, reply_to_user_id: replyData.reply_to_user_id || null }),
    });
    if (response.ok) {
      const comentario = await response.json();
      const lang = localStorage.getItem('language') || 'es';
      const commentDiv = document.createElement('div');
      commentDiv.classList.add('comment');
      if (comentario.parent_id) commentDiv.classList.add('reply');
      let contentDisplay = comentario.contenido;
      if (replyData.userName && contentDisplay.startsWith(`@${replyData.userName}`)) {
          contentDisplay = contentDisplay.replace(`@${replyData.userName}`, `<a href="#" class="mention-link">@${replyData.userName}</a>`);
      }
      let commentContent = `
        <div class="comment-profile-pic-container">
          ${comentario.foto_perfil_url ? `<img src="${comentario.foto_perfil_url}" class="comment-profile-pic">` : `<i class="fas fa-user comment-profile-icon"></i>`}
        </div>
        <div class="comment-content">
          <p class="comment-user" onclick="redirectToProfile(${comentario.user_id})">${comentario.nombre_empresa}</p>
          <p class="comment-text">${contentDisplay}</p>
          <div class="comment-actions">
            <p class="comment-meta">${formatDate(comentario.fecha_creacion, lang)}</p>
            <button class="reply-btn" onclick="prepareReply(${comentario.publicacion_id}, ${comentario.parent_id ? comentario.parent_id : comentario.id}, ${comentario.user_id}, '${comentario.nombre_empresa}')">Responder</button>
          </div>
        </div>
        <button class="comment-delete" onclick="borrarComentario(${comentario.id}, this.parentElement)"><i class="fas fa-trash"></i></button>
      `;
      commentDiv.innerHTML = commentContent;
      commentsContainer.appendChild(commentDiv);
      cancelReply(postId);
      showNotification(translations[lang].inicio.comment_success);
    } else {
      const data = await response.json();
      showNotification(`${translations[lang].inicio.comment_error}: ${data.detail}`, true);
    }
  } catch (error) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_error_network, true); }
}

async function toggleInterest(postId, button) {
  if (!currentUserId) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.comment_login_required, true); return; }
  try {
    const response = await fetch(`/publicacion/${postId}/interesar`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ user_id: currentUserId }),
    });
    if (response.ok) {
      const data = await response.json();
      const countSpan = button.nextElementSibling;
      const lang = localStorage.getItem('language') || 'es';
      if (interestedPosts.has(postId)) {
        interestedPosts.delete(postId);
        button.classList.remove('interested');
        button.innerHTML = `<i class="fas fa-plus"></i> <span>${translations[lang].inicio.interest_button}</span>`;
      } else {
        interestedPosts.add(postId);
        button.classList.add('interested');
        button.innerHTML = `<i class="fas fa-check"></i> <span>${translations[lang].inicio.interested_button}</span>`;
      }
      countSpan.textContent = translations[lang].inicio.interested_count_label.replace('0', data.interesados_count || 0);
    }
  } catch (error) { showNotification(translations[localStorage.getItem('language') || 'es'].inicio.interest_error_network, true); }
}

function updateNotificationCounter(count) {
  const counter = document.getElementById('notification-counter');
  notificationCount = count;
  counter.textContent = count > 9 ? '9+' : count;
  counter.style.display = count > 0 ? 'flex' : 'none';
}

async function loadNotifications() {
  try {
    const response = await fetch(`/notificaciones?limit=${notificationLimit}&offset=${notificationOffset}`, {
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
    });
    if (!response.ok) { if (response.status === 401) return; throw new Error("Err"); }
    const data = await response.json();
    const notifications = data.notificaciones || [];
    const notificationsList = document.getElementById('notifications-list');
    const loadMoreButton = document.getElementById('load-more-notifications');
    const lang = localStorage.getItem('language') || 'es';

    if (notificationOffset === 0) notificationsList.innerHTML = '';
    if (notifications.length === 0 && notificationOffset === 0) {
      notificationsList.innerHTML = `<p style="text-align: center; color: #666; padding: 12px;">${translations[lang].inicio.no_notifications}</p>`;
      loadMoreButton.style.display = 'none';
      return;
    }

    notifications.forEach(notification => {
      if (notificationsList.querySelector(`[data-notification-id="${notification.id}"]`)) return;
      const item = document.createElement('div');
      item.classList.add('notification-item');
      item.setAttribute('data-notification-id', notification.id);
      if (!notification.leida) item.classList.add('unread');
      let iconClass = 'fas fa-plus';
      let message = notification.mensaje || "Nueva interacción";
      if (notification.tipo === 'comentario') { iconClass = 'fas fa-comment'; message = `comentó: "${notification.mensaje}"`; }
      if (notification.tipo === 'respuesta') { iconClass = 'fas fa-reply'; message = `respondió: "${notification.mensaje}"`; }
      if (notification.tipo === 'mencion') { iconClass = 'fas fa-at'; message = `te mencionó: "${notification.mensaje}"`; }
      if (notification.tipo === 'interes') { iconClass = 'fas fa-heart'; message = `le interesa tu publicación`; }
      
      item.innerHTML = `<i class="${iconClass}"></i><span><strong>${notification.nombre_usuario || 'Alguien'}</strong> ${message}</span><p class="notification-meta">${formatDate(notification.fecha_creacion, lang)}</p>`;
      item.addEventListener('click', () => { markNotificationAsRead(notification.id); scrollToPost(notification.publicacion_id); document.getElementById('notifications-menu').style.display = 'none'; });
      notificationsList.appendChild(item);
    });
    updateNotificationCounter(data.no_leidas || 0);
    loadMoreButton.style.display = notificationOffset + notifications.length < data.total ? 'block' : 'none';
    notificationOffset += notifications.length;
    
    if (!document.getElementById('mark-all-read') && notifications.length > 0) {
        const btn = document.createElement('button');
        btn.id = 'mark-all-read';
        btn.classList.add('load-more-notifications');
        btn.textContent = translations[lang].inicio.mark_all_read;
        btn.addEventListener('click', markAllNotificationsAsRead);
        notificationsList.insertAdjacentElement('afterend', btn);
    }
  } catch (error) { console.error(error); }
}

async function markNotificationAsRead(notificationId) {
  try {
    const res = await fetch(`/notificaciones/${notificationId}/leida`, { method: 'POST', headers: {'Content-Type': 'application/json'}, credentials: 'include' });
    if (res.ok) {
      document.querySelector(`.notification-item[data-notification-id="${notificationId}"]`)?.classList.remove('unread');
      updateNotificationCounter(notificationCount - 1);
    }
  } catch (e) {}
}

async function markAllNotificationsAsRead() {
  try {
    const res = await fetch('/notificaciones/marcar_todas_leidas', { method: 'POST', headers: {'Content-Type': 'application/json'}, credentials: 'include' });
    if (res.ok) {
      document.querySelectorAll('.notification-item.unread').forEach(i => i.classList.remove('unread'));
      updateNotificationCounter(0);
    }
  } catch (e) {}
}

function scrollToPost(postId) {
  const el = document.querySelector(`.post[data-post-id="${postId}"]`);
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  else loadSinglePost(postId);
}

// --- FUNCIÓN MEJORADA PARA DETECTAR TEXTO LARGO ---
// Busca esta función en tu script y reemplázala
function checkContentHeight(postContent) {
  return new Promise(resolve => {
    // Un pequeño delay para asegurar que el DOM y las fuentes se hayan renderizado
    setTimeout(() => {
      const pElement = postContent.querySelector('p');
      if (!pElement) {
         resolve(false);
         return;
      }
      
      // Si la altura total del contenido es mayor a la altura máxima permitida (4.5em)
      // significa que el texto está siendo cortado por el CSS
      const isOverflowing = postContent.scrollHeight > postContent.clientHeight;
      
      resolve(isOverflowing);
    }, 50); 
  });
}

function toggleContent(postId, button) {
  const postContent = document.querySelector(`.post[data-post-id="${postId}"] .post-content`);
  const lang = localStorage.getItem('language') || 'es';
  
  if (postContent.classList.contains('expanded')) {
    postContent.classList.remove('expanded');
    button.textContent = "Ver más"; 
  } else {
    postContent.classList.add('expanded');
    button.textContent = "Ver menos"; 
  }
}

async function loadSinglePost(postId) {
  try {
    const res = await fetch(`/publicacion/${postId}`, { headers: {'Content-Type': 'application/json'}, credentials: 'include' });
    if (!res.ok) return;
    const pub = await res.json();
    const feedDiv = document.getElementById('feed');
    const lang = localStorage.getItem('language') || 'es';

    if (!loadedPostIds.has(pub.id)) {
      loadedPostIds.add(pub.id);
      const div = document.createElement('div');
      div.classList.add('post');
      div.setAttribute('data-post-id', pub.id);
      // ... (Generación del HTML del post similar a cargarFeed)
      // Para simplificar, se asume que cargarFeed maneja la estructura. 
      // Si necesitas esta función completa, usa la lógica de renderizado de abajo.
      // (Aquí inyecto el HTML simplificado para no repetir todo el bloque gigante, la lógica visual es la misma)
      
      // Renderizamos:
      div.innerHTML = generatePostHTML(pub, lang, currentUserId);
      feedDiv.prepend(div);
      
      // --- DENTRO DE LAS FUNCIONES DE CARGA (Feed, Search, etc) ---
const postContentElement = div.querySelector('.post-content');
const needsReadMore = await checkContentHeight(postContentElement);

if (needsReadMore) {
    const readMoreButton = document.createElement('span');
    readMoreButton.classList.add('read-more', 'visible'); // Añadimos 'visible' aquí
    readMoreButton.textContent = "Ver más"; 
    readMoreButton.addEventListener('click', () => toggleContent(pub.id, readMoreButton));
    
    // Insertamos después del contenido
    postContentElement.parentNode.insertBefore(readMoreButton, postContentElement.nextSibling);
}
      
      cargarComentarios(pub.id, document.getElementById(`comments-${pub.id}`), div.querySelector('.load-more-comments'));
      div.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  } catch (e) {}
}

async function initializeNotificationsWebSocket() {
  try {
    const res = await fetch('/current_user', { headers: {'Content-Type': 'application/json'}, credentials: 'include' });
    if(!res.ok) return;
    const data = await res.json();
    if(!data.user_id) return;
    wsNotifications = new WebSocket(`ws://${window.location.host}/notificaciones/ws/${data.user_id}`);
    wsNotifications.onopen = () => console.log('WS Notificaciones conectado');
    wsNotifications.onmessage = (event) => {
        const n = JSON.parse(event.data);
        // Lógica de actualización en tiempo real (mismo que tu código anterior)
        // ...
        // Se omite por brevedad pero mantén tu lógica original aquí
    };
  } catch(e){}
}

function startNotificationPolling() {
  setInterval(async () => {
    try {
        const res = await fetch('/notificaciones/no_leidas', {headers: {'Content-Type': 'application/json'}, credentials: 'include'});
        if(res.ok) { const d = await res.json(); updateNotificationCounter(d.no_leidas||0); }
    } catch(e){}
  }, 30000);
}

// Helper para generar HTML (DRY)
function generatePostHTML(pub, lang, currentUserId) {
    let menuOpciones = '';
    if (currentUserId && pub.user_id && Number(pub.user_id) === Number(currentUserId)) {
        menuOpciones = `<button class="dropdown-item danger" onclick="borrarPublicacion(${pub.id}, this.closest('.post'))"><i class="fas fa-trash-alt"></i> Eliminar</button>`;
    } else {
        menuOpciones = `<button class="dropdown-item danger" onclick="openReportModal(${pub.id})"><i class="fas fa-flag"></i> Reportar</button>`;
    }

    return `
        <div class="post-header">
          <div class="post-profile-pic-container">
            ${pub.foto_perfil_url ? `<img src="${pub.foto_perfil_url}" class="post-profile-pic">` : `<i class="fas fa-user post-profile-icon"></i>`}
          </div>
          <div class="post-user-info"><span class="company-name" onclick="redirectToProfile(${pub.user_id})">${pub.nombre_empresa}</span></div>
          <div class="post-options">
            <button class="options-btn" onclick="togglePostMenu(${pub.id}, event)"><i class="fas fa-ellipsis-v"></i></button>
            <div class="post-dropdown-menu" id="menu-post-${pub.id}">${menuOpciones}</div>
          </div>
        </div>
        <div class="post-content">${pub.contenido ? `<p>${pub.contenido}</p>` : ''}</div>
        <div class="post-media">
          ${pub.imagen_url ? `<img src="${pub.imagen_url}" onclick="openMediaViewer('${pub.imagen_url}', 'image')">` : ''}

${pub.video_url ? `
  <div class="video-thumbnail-container" onclick="openMediaViewer('${pub.video_url}', 'video')">
      <video src="${pub.video_url}#t=0.1" preload="metadata"></video>
      <div class="play-icon-overlay">
          <i class="fas fa-play"></i>
      </div>
  </div>` : ''}
        </div>
        <div class="post-meta">
          <p>${translations[lang].inicio.tags_label}: ${pub.etiquetas || ''}</p>
          <p data-original-date="${pub.fecha_creacion}">${formatDate(pub.fecha_creacion, lang)}</p>
          <button class="interest-button ${pub.interesado ? 'interested' : ''}" data-post-id="${pub.id}" onclick="toggleInterest(${pub.id}, this)">
            <i class="fas ${pub.interesado ? 'fa-check' : 'fa-plus'}"></i> <span>${translations[lang].inicio[pub.interesado ? 'interested_button' : 'interest_button']}</span>
          </button>
          <span class="interested-count">${pub.interesados_count || 0}</span>
        </div>
        <div class="comments-section">
          <div class="comment-form">
             <div class="reply-indicator" style="display:none"><span>...</span><button onclick="cancelReply(${pub.id})">×</button></div>
             <div class="comment-input-wrapper">
                <input type="text" class="comment-input" placeholder="...">
                <button class="comment-submit" onclick="submitComment(${pub.id}, this.previousElementSibling, this.parentElement.parentElement.nextElementSibling)">Enviar</button>
             </div>
          </div>
          <div class="comments-list" id="comments-${pub.id}"></div>
          <div class="load-more-comments" style="display: none;" onclick="cargarComentarios(${pub.id}, document.getElementById('comments-${pub.id}'), this)">Ver más comentarios</div>
        </div>
    `;
}

async function cargarFeed() {
  if (isLoading || !hasMore || isSearching) return;
  isLoading = true;
  try {
    const res = await fetch(`/feed?limit=${limit}&offset=${offset}`, { headers: {'Content-Type': 'application/json'}, credentials: 'include' });
    if (!res.ok) { if (res.status === 401) showNotification("Inicia sesión", true); return; }
    const publicaciones = await res.json();
    if (publicaciones.length === 0 && offset === 0) { document.getElementById('feed').innerHTML = '<p style="text-align: center;">No hay publicaciones</p>'; hasMore = false; return; }
    if (publicaciones.length < limit) hasMore = false;
    
    const feedDiv = document.getElementById('feed');
    const lang = localStorage.getItem('language') || 'es';

    for (const pub of publicaciones) {
      if (loadedPostIds.has(pub.id)) continue;
      loadedPostIds.add(pub.id);
      if (pub.interesado) interestedPosts.add(pub.id);

      const div = document.createElement('div');
      div.classList.add('post');
      div.setAttribute('data-post-id', pub.id);
      div.innerHTML = generatePostHTML(pub, lang, currentUserId);
      feedDiv.appendChild(div);

      // --- AQUÍ ESTÁ LA MAGIA DEL BOTÓN VER MÁS ---
      // --- DENTRO DE LAS FUNCIONES DE CARGA (Feed, Search, etc) ---
const postContentElement = div.querySelector('.post-content');
const needsReadMore = await checkContentHeight(postContentElement);

if (needsReadMore) {
    const readMoreButton = document.createElement('span');
    readMoreButton.classList.add('read-more', 'visible'); // Añadimos 'visible' aquí
    readMoreButton.textContent = "Ver más"; 
    readMoreButton.addEventListener('click', () => toggleContent(pub.id, readMoreButton));
    
    // Insertamos después del contenido
    postContentElement.parentNode.insertBefore(readMoreButton, postContentElement.nextSibling);
}
      
      cargarComentarios(pub.id, document.getElementById(`comments-${pub.id}`), div.querySelector('.load-more-comments'));
    }
    offset += limit;
  } catch (e) { console.error(e); } finally { isLoading = false; }
}

async function search() {
  const query = document.getElementById('buscador').value.trim();
  const feedDiv = document.getElementById('feed');
  loadedPostIds.clear();
  offset = 0; hasMore = true;
  if (!query) { isSearching = false; feedDiv.innerHTML = ''; await cargarFeed(); return; }
  isSearching = true; feedDiv.innerHTML = '';
  
  try {
      const res = await fetch(`/search?query=${encodeURIComponent(query)}&limit=${limit}&offset=${offset}`, { headers: {'Content-Type': 'application/json'}, credentials: 'include' });
      if(!res.ok) return;
      const publicaciones = await res.json();
      if(publicaciones.length < limit) hasMore = false;
      const lang = localStorage.getItem('language') || 'es';

      for (const pub of publicaciones) {
          if (loadedPostIds.has(pub.id)) continue;
          loadedPostIds.add(pub.id);
          const div = document.createElement('div');
          div.classList.add('post');
          div.setAttribute('data-post-id', pub.id);
          div.innerHTML = generatePostHTML(pub, lang, currentUserId);
          feedDiv.appendChild(div);

          // --- DENTRO DE LAS FUNCIONES DE CARGA (Feed, Search, etc) ---
const postContentElement = div.querySelector('.post-content');
const needsReadMore = await checkContentHeight(postContentElement);

if (needsReadMore) {
    const readMoreButton = document.createElement('span');
    readMoreButton.classList.add('read-more', 'visible'); // Añadimos 'visible' aquí
    readMoreButton.textContent = "Ver más"; 
    readMoreButton.addEventListener('click', () => toggleContent(pub.id, readMoreButton));
    
    // Insertamos después del contenido
    postContentElement.parentNode.insertBefore(readMoreButton, postContentElement.nextSibling);
}
          cargarComentarios(pub.id, document.getElementById(`comments-${pub.id}`), div.querySelector('.load-more-comments'));
      }
      offset += limit;
  } catch(e) {}
}

async function filterByCategory(categoria) {
  const feedDiv = document.getElementById('feed');
  loadedPostIds.clear(); offset = 0; hasMore = true;
  document.querySelectorAll('.categoria-filter').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-categoria') === categoria) btn.classList.add('active');
  });
  if (!categoria) { isSearching = false; feedDiv.innerHTML = ''; await cargarFeed(); return; }
  isSearching = true; feedDiv.innerHTML = '';
  // Reutiliza la misma lógica de search...
  try {
      const res = await fetch(`/search?query=${encodeURIComponent(categoria)}&limit=${limit}&offset=${offset}`, { headers: {'Content-Type': 'application/json'}, credentials: 'include' });
      const publicaciones = await res.json();
      const lang = localStorage.getItem('language') || 'es';
      for (const pub of publicaciones) {
          if (loadedPostIds.has(pub.id)) continue;
          loadedPostIds.add(pub.id);
          const div = document.createElement('div');
          div.classList.add('post');
          div.setAttribute('data-post-id', pub.id);
          div.innerHTML = generatePostHTML(pub, lang, currentUserId);
          feedDiv.appendChild(div);
          
          // --- DENTRO DE LAS FUNCIONES DE CARGA (Feed, Search, etc) ---
const postContentElement = div.querySelector('.post-content');
const needsReadMore = await checkContentHeight(postContentElement);

if (needsReadMore) {
    const readMoreButton = document.createElement('span');
    readMoreButton.classList.add('read-more', 'visible'); // Añadimos 'visible' aquí
    readMoreButton.textContent = "Ver más"; 
    readMoreButton.addEventListener('click', () => toggleContent(pub.id, readMoreButton));
    
    // Insertamos después del contenido
    postContentElement.parentNode.insertBefore(readMoreButton, postContentElement.nextSibling);
}
          cargarComentarios(pub.id, document.getElementById(`comments-${pub.id}`), div.querySelector('.load-more-comments'));
      }
  } catch(e){}
}

const imagenInput = document.getElementById('imagen');
const videoInput = document.getElementById('video');
const contentInput = document.getElementById('content-input');
const contenidoHidden = document.getElementById('contenido-hidden');
const etiquetasHidden = document.getElementById('etiquetas-hidden');
const previewArea = document.getElementById('preview-area');
const form = document.getElementById('form-publicar');
const etiquetasPreview = document.getElementById('etiquetas-preview');

function clearPreview() { previewArea.innerHTML = ''; imagenInput.value = ''; videoInput.value = ''; }

function addPreview(file, type) {
  if (!file) return;
  const wrapper = document.createElement('span');
  wrapper.classList.add('preview-wrapper');
  const previewElement = document.createElement('img');
  previewElement.classList.add(type === 'image' ? 'preview-image' : 'preview-video');
  const removeButton = document.createElement('button');
  removeButton.classList.add('remove-preview');
  removeButton.innerHTML = '×';
  removeButton.addEventListener('click', () => {
    wrapper.remove();
    if (type === 'image') imagenInput.value = ''; else videoInput.value = '';
    if (previewElement.src.startsWith('blob:')) URL.revokeObjectURL(previewElement.src);
  });
  if (type === 'image') {
    previewElement.src = URL.createObjectURL(file);
    wrapper.appendChild(previewElement); wrapper.appendChild(removeButton); previewArea.innerHTML = ''; previewArea.appendChild(wrapper);
  } else {
    const video = document.createElement('video');
    video.src = URL.createObjectURL(file);
    video.addEventListener('loadeddata', () => video.currentTime = 1);
    video.addEventListener('seeked', () => {
      const canvas = document.createElement('canvas'); canvas.width = 50; canvas.height = 50;
      const ctx = canvas.getContext('2d'); ctx.drawImage(video, 0, 0, 50, 50);
      previewElement.src = canvas.toDataURL('image/png');
      wrapper.appendChild(previewElement); wrapper.appendChild(removeButton); previewArea.innerHTML = ''; previewArea.appendChild(wrapper);
      URL.revokeObjectURL(video.src);
    }, { once: true });
  }
}

imagenInput.addEventListener('change', () => { if (imagenInput.files && imagenInput.files[0]) addPreview(imagenInput.files[0], 'image'); });
videoInput.addEventListener('change', () => { if (videoInput.files && videoInput.files[0]) addPreview(videoInput.files[0], 'video'); });

function updateEtiquetasPreview() {
  etiquetasPreview.innerHTML = '';
  const selectedCategorias = Array.from(document.querySelectorAll('input[name="categorias"]:checked')).map(input => input.value);
  let etiquetas = selectedCategorias.filter(cat => cat !== 'otro');
  if (selectedCategorias.includes('otro')) {
    const otraCategoria = document.getElementById('otra-categoria-input').value.trim();
    if (otraCategoria) etiquetas.push(otraCategoria);
  }
  etiquetasHidden.value = etiquetas.join(',');
  etiquetas.forEach(tag => {
    const pill = document.createElement('span'); pill.classList.add('etiqueta-pill');
    pill.innerHTML = `${tag} <button class="remove-etiqueta">×</button>`;
    pill.querySelector('.remove-etiqueta').addEventListener('click', () => {
      pill.remove();
      const checkbox = document.querySelector(`input[name="categorias"][value="${tag}"]`);
      if (checkbox) checkbox.checked = false;
      else { document.getElementById('cat-otro').checked = false; document.getElementById('otra-categoria-input').value = ''; document.getElementById('otra-categoria').style.display = 'none'; }
      updateEtiquetasPreview();
    });
    etiquetasPreview.appendChild(pill);
  });
}

function closeAllMenus(excludeNotifications = false) {
  ['menu-perfil', 'language-menu', 'categorias-menu'].forEach(id => { document.getElementById(id).style.display = 'none'; });
  if (!excludeNotifications) document.getElementById('notifications-menu').style.display = 'none';
}

function toggleMenu(menuId, event) {
  event.stopPropagation();
  const menu = document.getElementById(menuId);
  const isOpen = menu.style.display === 'block';
  closeAllMenus(menuId !== 'notifications-menu');
  if (!isOpen) {
    menu.style.display = 'block';
    if (menuId === 'notifications-menu') { notificationOffset = 0; loadNotifications(); }
  } else { menu.style.display = 'none'; }
}

document.getElementById('perfil-btn').addEventListener('click', (e) => toggleMenu('menu-perfil', e));
document.getElementById('language-toggle').addEventListener('click', (e) => toggleMenu('language-menu', e));
document.getElementById('categorias-toggle').addEventListener('click', (e) => toggleMenu('categorias-menu', e));
document.getElementById('notifications-toggle').addEventListener('click', (e) => toggleMenu('notifications-menu', e));

['menu-perfil', 'language-menu', 'categorias-menu', 'notifications-menu'].forEach(id => { document.getElementById(id).addEventListener('click', (e) => e.stopPropagation()); });

document.querySelectorAll('#language-menu button[data-lang]').forEach(btn => {
  btn.addEventListener('click', function() {
    const lang = this.getAttribute('data-lang');
    localStorage.setItem('language', lang);
    updateLanguage(lang);
    closeAllMenus();
  });
});

document.getElementById('categorias-listo').addEventListener('click', (e) => { e.stopPropagation(); document.getElementById('categorias-menu').style.display = 'none'; updateEtiquetasPreview(); });
document.getElementById('cat-otro').addEventListener('change', function() { document.getElementById('otra-categoria').style.display = this.checked ? 'block' : 'none'; });
document.querySelectorAll('input[name="categorias"]').forEach(input => { input.addEventListener('change', updateEtiquetasPreview); });
document.getElementById('otra-categoria-input').addEventListener('input', updateEtiquetasPreview);
contentInput.addEventListener('input', () => { contenidoHidden.value = contentInput.innerText; });

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const lang = localStorage.getItem('language') || 'es';
  const contenido = contentInput.innerText.trim();
  const etiquetas = etiquetasHidden.value.trim();
  if (!contenido && !imagenInput.files[0] && !videoInput.files[0] && !etiquetas) { showNotification("Completa algún campo", true); return; }
  const formData = new FormData();
  if (contenido) formData.append('contenido', contenido);
  if (etiquetas) formData.append('etiquetas', etiquetas);
  if (imagenInput.files[0]) formData.append('imagen', imagenInput.files[0]);
  else if (videoInput.files[0]) formData.append('video', videoInput.files[0]);

  try {
    const res = await fetch('/publicar', { method: 'POST', body: formData, credentials: 'include' });
    if (res.ok) {
      form.reset(); contentInput.innerText = ''; contenidoHidden.value = ''; etiquetasHidden.value = ''; clearPreview(); etiquetasPreview.innerHTML = '';
      document.querySelectorAll('input[name="categorias"]').forEach(i => i.checked = false);
      document.getElementById('otra-categoria').style.display = 'none';
      showNotification(translations[lang].inicio.post_success);
      loadedPostIds.clear(); offset = 0; hasMore = true; document.getElementById('feed').innerHTML = '';
      await cargarFeed();
    } else { const d = await res.json(); showNotification(`Error: ${d.detail}`, true); }
  } catch (e) { showNotification("Error de red", true); }
});

let isScrolling = false;
function handleScroll() {
  if (isScrolling) return;
  isScrolling = true;
  setTimeout(() => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100 && !isLoading && hasMore) {
      if (isSearching) {
        const active = document.querySelector('.categoria-filter.active');
        if (active) filterByCategory(active.getAttribute('data-categoria')); else search();
      } else { cargarFeed(); }
    }
    isScrolling = false;
  }, 100);
}

// Inicialización de WebSockets para Chats (Simplificado para el ejemplo)
async function initializeWebSocket() {
    try {
        const res = await fetch('/current_user', {headers: {'Content-Type': 'application/json'}, credentials: 'include'});
        if(res.ok){ const d = await res.json(); if(d.user_id){
            const ws = new WebSocket(`ws://${window.location.host}/chats/ws/${d.user_id}`);
            ws.onmessage = () => updateChatsUnreadCounter();
        }}
    } catch(e){}
}
async function updateChatsUnreadCounter() {
    try { const res = await fetch('/chats/unread_count', {headers: {'Content-Type': 'application/json'}, credentials: 'include'}); if(res.ok){ const d = await res.json(); const c = document.getElementById('chats-unread-counter'); c.textContent = d.unread_count > 9 ? '9+' : d.unread_count; c.style.display = d.unread_count > 0 ? 'flex' : 'none'; } } catch(e){}
}
function startChatsPolling() { setInterval(updateChatsUnreadCounter, 30000); }

// --- VISOR MULTIMEDIA ---
let currentZoom = 1;
function openMediaViewer(url, type) {
  const viewer = document.getElementById('media-viewer');
  const container = document.getElementById('media-container');
  container.innerHTML = ''; currentZoom = 1;
  if (type === 'image') {
    const img = document.createElement('img'); img.src = url; img.id = 'media-viewer-content'; container.appendChild(img);
  } else if (type === 'video') {
    const video = document.createElement('video'); video.src = url; video.id = 'media-viewer-content'; video.controls = true; video.autoplay = true; video.style.maxHeight = "80vh"; container.appendChild(video);
  }
  viewer.classList.add('active');
  document.body.style.overflow = 'hidden';
}
function closeMediaViewer() {
  const viewer = document.getElementById('media-viewer');
  const container = document.getElementById('media-container');
  const video = container.querySelector('video'); if (video) video.pause();
  viewer.classList.remove('active'); container.innerHTML = ''; document.body.style.overflow = '';
}
function zoomMedia(delta) {
  const content = document.getElementById('media-viewer-content'); if (!content) return;
  currentZoom += delta; if (currentZoom < 0.5) currentZoom = 0.5; if (currentZoom > 3) currentZoom = 3;
  content.style.transform = `scale(${currentZoom})`;
}

document.addEventListener('DOMContentLoaded', async () => {
  const savedLang = localStorage.getItem('language') || 'es';
  updateLanguage(savedLang);
  await fetchCurrentUserId();
  cargarFeed();
  loadNotifications();
  startNotificationPolling();
  initializeWebSocket();
  initializeNotificationsWebSocket();
  updateChatsUnreadCounter();
  startChatsPolling();
  window.addEventListener('scroll', handleScroll);
  document.querySelectorAll('.categoria-filter').forEach(btn => {
    btn.addEventListener('click', () => filterByCategory(btn.getAttribute('data-categoria')));
  });
});

document.getElementById('buscador').addEventListener('input', debounce(search, 300));
function debounce(func, wait) { let timeout; return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func(...args), wait); }; }
</script>
</body>
</html>
